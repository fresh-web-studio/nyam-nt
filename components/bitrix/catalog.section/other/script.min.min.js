(function(){if(!!window.JCCatalogSectionComponent){return}window.JCCatalogSectionComponent=function(a){this.formPosting=false;this.siteId=a.siteId||"";this.ajaxId=a.ajaxId||"";this.template=a.template||"";this.componentPath=a.componentPath||"";this.parameters=a.parameters||"";if(a.navParams){this.navParams={NavNum:a.navParams.NavNum||1,NavPageNomer:parseInt(a.navParams.NavPageNomer)||1,NavPageCount:parseInt(a.navParams.NavPageCount)||1}}this.bigData=a.bigData||{enabled:false};this.container=document.querySelector('[data-entity="'+a.container+'"]');this.showMoreButton=null;this.showMoreButtonMessage=null;if(this.bigData.enabled&&BX.util.object_keys(this.bigData.rows).length>0){BX.cookie_prefix=this.bigData.js.cookiePrefix||"";BX.cookie_domain=this.bigData.js.cookieDomain||"";BX.current_server_time=this.bigData.js.serverTime;BX.ready(BX.delegate(this.bigDataLoad,this))}if(a.initiallyShowHeader){BX.ready(BX.delegate(this.showHeader,this))}if(a.deferredLoad){BX.ready(BX.delegate(this.deferredLoad,this))}if(a.lazyLoad){this.showMoreButton=document.querySelector('[data-use="show-more-'+this.navParams.NavNum+'"]');this.showMoreButtonMessage=this.showMoreButton.innerHTML;BX.bind(this.showMoreButton,"click",BX.proxy(this.showMore,this))}if(a.loadOnScroll){BX.bind(window,"scroll",BX.proxy(this.loadOnScroll,this))}};window.JCCatalogSectionComponent.prototype={checkButton:function(){if(this.showMoreButton){if(this.navParams.NavPageNomer==this.navParams.NavPageCount){BX.remove(this.showMoreButton)}else{this.container.appendChild(this.showMoreButton)}}},enableButton:function(){if(this.showMoreButton){BX.removeClass(this.showMoreButton,"disabled");this.showMoreButton.innerHTML=this.showMoreButtonMessage}},disableButton:function(){if(this.showMoreButton){BX.addClass(this.showMoreButton,"disabled");this.showMoreButton.innerHTML=BX.message("BTN_MESSAGE_LAZY_LOAD_WAITER")}},loadOnScroll:function(){var a=BX.GetWindowScrollPos().scrollTop,b=BX.pos(this.container).bottom;if(a+window.innerHeight>b){this.showMore()}},showMore:function(){if(this.navParams.NavPageNomer<this.navParams.NavPageCount){var a={};a.action="showMore";a["PAGEN_"+this.navParams.NavNum]=this.navParams.NavPageNomer+1;if(!this.formPosting){this.formPosting=true;this.disableButton();this.sendRequest(a)}}},bigDataLoad:function(){var c="https://analytics.bitrix.info/crecoms/v1_0/recoms.php",d=BX.ajax.prepareData(this.bigData.params);if(d){c+=(c.indexOf("?")!==-1?"&":"?")+d}var b=BX.delegate(function(a){this.sendRequest({action:"deferredLoad",bigData:"Y",items:a&&a.items||[],rid:a&&a.id,count:this.bigData.count,rowsRange:this.bigData.rowsRange,shownIds:this.bigData.shownIds})},this);BX.ajax({method:"GET",dataType:"json",url:c,timeout:3,onsuccess:b,onfailure:b})},deferredLoad:function(){this.sendRequest({action:"deferredLoad"})},sendRequest:function(a){var b={siteId:this.siteId,template:this.template,parameters:this.parameters};if(this.ajaxId){b.AJAX_ID=this.ajaxId}BX.ajax({url:this.componentPath+"/ajax.php"+(document.location.href.indexOf("clear_cache=Y")!==-1?"?clear_cache=Y":""),method:"POST",dataType:"json",timeout:60,data:BX.merge(b,a),onsuccess:BX.delegate(function(c){if(!c||!c.JS){return}BX.ajax.processScripts(BX.processHTML(c.JS).SCRIPT,false,BX.delegate(function(){this.showAction(c,a)},this))},this)})},showAction:function(a,b){if(!b){return}switch(b.action){case"showMore":this.processShowMoreAction(a);break;case"deferredLoad":this.processDeferredLoadAction(a,b.bigData==="Y");break}},processShowMoreAction:function(a){this.formPosting=false;this.enableButton();if(a){this.navParams.NavPageNomer++;this.processItems(a.items);this.processPagination(a.pagination);this.processEpilogue(a.epilogue);this.checkButton()}},processDeferredLoadAction:function(c,d){if(!c){return}var b=d?this.bigData.rows:{};this.processItems(c.items,BX.util.array_keys(b))},processItems:function(d,g){if(!d){return}var b=BX.processHTML(d,false),c=BX.create("DIV");var f,h,j;c.innerHTML=b.HTML;f=c.querySelectorAll('[data-entity="items-row"]');if(f.length){this.showHeader(true);for(h in f){if(f.hasOwnProperty(h)){j=g?this.container.querySelectorAll('[data-entity="items-row"]'):false;f[h].style.opacity=0;if(j&&BX.type.isDomNode(j[g[h]])){j[g[h]].parentNode.insertBefore(f[h],j[g[h]])}else{this.container.appendChild(f[h])}}}new BX.easing({duration:2000,start:{opacity:0},finish:{opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(a){for(var i in f){if(f.hasOwnProperty(i)){f[i].style.opacity=a.opacity/100}}},complete:function(){for(var a in f){if(f.hasOwnProperty(a)){f[a].removeAttribute("style")}}}}).animate()}BX.ajax.processScripts(b.SCRIPT)},processPagination:function(c){if(!c){return}var d=document.querySelectorAll('[data-pagination-num="'+this.navParams.NavNum+'"]');for(var b in d){if(d.hasOwnProperty(b)){d[b].innerHTML=c}}},processEpilogue:function(a){if(!a){return}var b=BX.processHTML(a,false);BX.ajax.processScripts(b.SCRIPT)},showHeader:function(c){var d=BX.findParent(this.container,{attr:{"data-entity":"parent-container"}}),b;if(d&&BX.type.isDomNode(d)){b=d.querySelector('[data-entity="header"]');if(b&&b.getAttribute("data-showed")!="true"){b.style.display="";if(c){new BX.easing({duration:2000,start:{opacity:0},finish:{opacity:100},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(a){b.style.opacity=a.opacity/100},complete:function(){b.removeAttribute("style");b.setAttribute("data-showed","true")}}).animate()}else{b.style.opacity=100}}}}}})();