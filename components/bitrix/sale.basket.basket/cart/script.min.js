BasketPoolQuantity=function(){this.processing=false;this.poolQuantity={};this.updateTimer=null;this.currentQuantity={};this.lastStableQuantities={};this.updateQuantity()};BasketPoolQuantity.prototype.updateQuantity=function(){var a=BX("basket_items");if(basketJSParams.USE_ENHANCED_ECOMMERCE==="Y"){checkAnalytics(this.lastStableQuantities,a)}if(!!a&&a.rows.length>0){for(var b=1;a.rows.length>b;b++){var c=a.rows[b].id;this.currentQuantity[c]=BX("QUANTITY_"+c).value}}this.lastStableQuantities=BX.clone(this.currentQuantity,true)};BasketPoolQuantity.prototype.changeQuantity=function(c){var b=BX("QUANTITY_"+c).value;var a=this.isPoolEmpty();if(this.currentQuantity[c]&&this.currentQuantity[c]!=b){this.poolQuantity[c]=this.currentQuantity[c]=b}if(!a){this.enableTimer(true)}else{this.trySendPool()}};BasketPoolQuantity.prototype.trySendPool=function(){if(!this.isPoolEmpty()&&!this.isProcessing()){this.enableTimer(false);recalcBasketAjax({})}};BasketPoolQuantity.prototype.isPoolEmpty=function(){return(Object.keys(this.poolQuantity).length==0)};BasketPoolQuantity.prototype.clearPool=function(){this.poolQuantity={}};BasketPoolQuantity.prototype.isProcessing=function(){return(this.processing===true)};BasketPoolQuantity.prototype.setProcessing=function(a){this.processing=(a===true)};BasketPoolQuantity.prototype.enableTimer=function(a){clearTimeout(this.updateTimer);if(a===false){return}this.updateTimer=setTimeout(function(){basketPoolQuantity.trySendPool()},1500)};function updateBasketTable(X,T){var C=BX("basket_items"),ai,ac,v,J,b,G,ab=false,Q=false,ak=false,I=false,o,L,aa,ah,l,D,Y,A,f,E,ag,O,w,g,W,H,al,z,d,K,n,y,N,t,ad,r,x,af,Z,c,F,ae,a,V,p,B,h,S,m,U,e,q,P;if(!C||typeof T!=="object"){return}ai=C.rows;J=ai[ai.length-1];o=(T.PARAMS.QUANTITY_FLOAT==="Y");if(X!==null&&!!T.BASKET_DATA){L=BX(X);ac=T.BASKET_ID;P=BX.type.isPlainObject(T.BASKET_DATA.GRID.ROWS[ac]);if(P){v=T.BASKET_DATA.GRID.ROWS[ac];b=document.createElement("tr");b.setAttribute("id",T.BASKET_ID);b.setAttribute("data-item-name",v.NAME);b.setAttribute("data-item-brand",v[basketJSParams.BRAND_PROPERTY+"_VALUE"]);b.setAttribute("data-item-price",v.PRICE);b.setAttribute("data-item-currency",v.CURRENCY);J.parentNode.insertBefore(b,L.nextSibling)}if(T.DELETE_ORIGINAL==="Y"){L.parentNode.removeChild(L)}if(P){aa=b.insertCell(-1);aa.setAttribute("class","margin");G=T.COLUMNS.split(",");for(ah=0;ah<G.length;ah++){if(G[ah]==="DELETE"){ab=true}else{if(G[ah]==="DELAY"){Q=true}else{if(G[ah]==="PROPS"){ak=true}else{if(G[ah]==="TYPE"){I=true}}}}}for(ah=0;ah<G.length;ah++){switch(G[ah]){case"PROPS":case"DELAY":case"DELETE":case"TYPE":break;case"NAME":l=b.insertCell(-1);D="";Y="";l.setAttribute("class","itemphoto");if(v.PREVIEW_PICTURE_SRC.length>0){D=v.PREVIEW_PICTURE_SRC}else{if(v.DETAIL_PICTURE_SRC.length>0){D=v.DETAIL_PICTURE_SRC}else{D=basketJSParams.TEMPLATE_FOLDER+"/images/no_photo.png"}}if(v.DETAIL_PAGE_URL.length>0){Y='<div class="bx_ordercart_photo_container">							<a href="'+v.DETAIL_PAGE_URL+'">								<div class="bx_ordercart_photo" style="background-image:url(\''+D+"')\"></div>							</a>						</div>"}else{Y='<div class="bx_ordercart_photo_container">							<div class="bx_ordercart_photo" style="background-image:url(\''+D+"')\"></div>						</div>"}if(v.BRAND&&v.BRAND.length>0){Y+='<div class="bx_ordercart_brand">							<img alt="" src="'+v.BRAND+'"/>						</div>'}l.innerHTML=Y;A=b.insertCell(-1);f="";A.setAttribute("class","item");if(v.DETAIL_PAGE_URL.length>0){f+='<h2 class="bx_ordercart_itemtitle"><a href="'+v.DETAIL_PAGE_URL+'">'+v.NAME+"</a></h2>"}else{f+='<h2 class="bx_ordercart_itemtitle">'+v.NAME+"</h2>"}f+='<div class="bx_ordercart_itemart">';if(ak){for(ag=0;ag<v.PROPS.length;ag++){O=v.PROPS[ag];if(v.SKU_DATA){E=false;for(w in v.SKU_DATA){if(v.SKU_DATA.hasOwnProperty(w)){g=v.SKU_DATA[w];if(g.CODE===O.CODE){E=true;break}}}if(E){continue}}f+=BX.util.htmlspecialchars(O.NAME)+":&nbsp;<span>"+O.VALUE+"</span><br/>"}}f+="</div>";if(v.SKU_DATA){m={};for(ad=0;ad<v.PROPS.length;ad++){r=v.PROPS[ad];m[r.CODE]=(BX.type.isNotEmptyString(r["~VALUE"])?r["~VALUE"]:r.VALUE)}for(w in v.SKU_DATA){if(v.SKU_DATA.hasOwnProperty(w)){U=0;g=v.SKU_DATA[w];W=false;H=BX.util.array_keys(g.VALUES).length;if(H>5){al="full";z=(H*20)+"%";d=(100/H)+"%"}else{al="";z="100%";d="20%"}e=0;for(n in g.VALUES){e++;K=g.VALUES[n];if(BX.type.isNotEmptyString(m[g.CODE])){if(m[g.CODE]==K.NAME||m[g.CODE]==K.XML_ID){U=e}}if(!!K&&typeof K==="object"&&!!K.PICT){W=true}}q="0";if(al!==""&&U>5){q=((5-U)*20)+"%"}if(W){f+='<div class="bx_item_detail_scu_small_noadaptive '+al+'">';f+='<span class="bx_item_section_name_gray">'+BX.util.htmlspecialchars(g.NAME)+"</span>";f+='<div class="bx_scu_scroller_container">';f+='<div class="bx_scu">';f+='<ul id="prop_'+g.CODE+"_"+v.ID+'" style="width: '+z+"; margin-left: "+q+';" class="sku_prop_list">';e=0;for(t in g.VALUES){e++;y=g.VALUES[t];N=(U==e?" bx_active":"");f+='<li style="width: '+d+"; padding-top: "+d+';"															class="sku_prop'+N+'" 															data-sku-selector="Y" 															data-value-id="'+y.XML_ID+'" 															data-sku-name="'+BX.util.htmlspecialchars(y.NAME)+'" 															data-element="'+v.ID+'" 															data-property="'+g.CODE+'"															>															<a href="javascript:void(0)" class="cnt"><span class="cnt_item" style="background-image:url('+y.PICT["SRC"]+'"></span></a>														</li>'}f+="</ul>";f+="</div>";f+='<div class="bx_slide_left" onclick="leftScroll(\''+g.CODE+"', "+v.ID+", "+BX.util.array_keys(g.VALUES).length+');"></div>';f+='<div class="bx_slide_right" onclick="rightScroll(\''+g.CODE+"', "+v.ID+", "+BX.util.array_keys(g.VALUES).length+');"></div>';f+="</div>";f+="</div>"}else{f+='<div class="bx_item_detail_size_small_noadaptive '+al+'">';f+='<span class="bx_item_section_name_gray">'+BX.util.htmlspecialchars(g.NAME)+"</span>";f+='<div class="bx_size_scroller_container">';f+='<div class="bx_size">';f+='<ul id="prop_'+g.CODE+"_"+v.ID+'" style="width: '+z+"; margin-left: "+q+';" class="sku_prop_list">';e=0;for(t in g.VALUES){e++;y=g.VALUES[t];N=(U==e?" bx_active":"");f+='<li style="width: '+d+';"															class="sku_prop '+N+'" 															data-sku-selector="Y" 															data-value-id="'+(g.TYPE==="S"&&g.USER_TYPE==="directory"?y.XML_ID:BX.util.htmlspecialchars(y.NAME))+'" 															data-sku-name="'+BX.util.htmlspecialchars(y.NAME)+'" 															data-element="'+v.ID+'" 															data-property="'+g.CODE+'" 															>															<a href="javascript:void(0)" class="cnt">'+BX.util.htmlspecialchars(y.NAME)+"</a>														</li>"}f+="</ul>";f+="</div>";f+='<div class="bx_slide_left" onclick="leftScroll(\''+g.CODE+"', "+v.ID+", "+BX.util.array_keys(g.VALUES).length+');"></div>';f+='<div class="bx_slide_right" onclick="rightScroll(\''+g.CODE+"', "+v.ID+", "+BX.util.array_keys(g.VALUES).length+');"></div>';f+="</div>";f+="</div>"}}}}A.innerHTML=f;break;case"QUANTITY":x=b.insertCell(-1);af="";Z=(parseFloat(v.MEASURE_RATIO)>0)?v.MEASURE_RATIO:1;c=false;if(Z!=0&&Z!=""){F=v.QUANTITY;v.QUANTITY=getCorrectRatioQuantity(v.QUANTITY,Z,o);if(F!=v.QUANTITY){c=true}}x.setAttribute("class","custom");af+="<span>"+getColumnName(T,G[ah])+":</span>";af+='<div class="centered">';af+='<table cellspacing="0" cellpadding="0" class="counter">';af+="<tr>";af+="<td>";af+='<input type="text" size="3" id="QUANTITY_INPUT_'+v.ID+'"											name="QUANTITY_INPUT_'+v.ID+'"											style="max-width: 50px"											value="'+v.QUANTITY+'"											onchange="updateQuantity(\'QUANTITY_INPUT_'+v.ID+"','"+v.ID+"', "+Z+","+o+')"						>';af+="</td>";if(Z!=0&&Z!=""){af+='<td id="basket_quantity_control">							<div class="basket_quantity_control">								<a href="javascript:void(0);" class="plus" onclick="setQuantity('+v.ID+", "+Z+", 'up', "+o+');"></a>								<a href="javascript:void(0);" class="minus" onclick="setQuantity('+v.ID+", "+Z+", 'down', "+o+');"></a>							</div>						</td>'}if(v.hasOwnProperty("MEASURE_TEXT")&&v.MEASURE_TEXT.length>0){af+='<td style="text-align: left">'+BX.util.htmlspecialchars(v.MEASURE_TEXT)+"</td>"}af+="</tr>";af+="</table>";af+="</div>";af+='<input type="hidden" id="QUANTITY_'+v.ID+'" name="QUANTITY_'+v.ID+'" value="'+v.QUANTITY+'" />';x.innerHTML=af;if(c){updateQuantity("QUANTITY_INPUT_"+v.ID,v.ID,Z,o)}break;case"PRICE":ae=b.insertCell(-1);a=(v.DISCOUNT_PRICE_PERCENT>0)?v.FULL_PRICE_FORMATED:"";ae.setAttribute("class","price");ae.innerHTML='<div class="current_price" id="current_price_'+v.ID+'">'+v.PRICE_FORMATED+'</div><div class="old_price" id="old_price_'+v.ID+'">'+a+"</div>";if(I&&v.NOTES.length>0){ae.innerHTML+='<div class="type_price">'+basketJSParams.SALE_TYPE+"</div>";ae.innerHTML+='<div class="type_price_value">'+v.NOTES+"</div>"}break;case"DISCOUNT":p=b.insertCell(-1);p.setAttribute("class","custom");p.innerHTML="<span>"+getColumnName(T,G[ah])+":</span>";p.innerHTML+='<div id="discount_value_'+v.ID+'">'+v.DISCOUNT_PRICE_PERCENT_FORMATED+"</div>";break;case"WEIGHT":B=b.insertCell(-1);B.setAttribute("class","custom");B.innerHTML="<span>"+getColumnName(T,G[ah])+":</span>";B.innerHTML+=v.WEIGHT_FORMATED;break;default:h=b.insertCell(-1);S="";h.setAttribute("class","custom");h.innerHTML="<span>"+getColumnName(T,G[ah])+":</span>";if(G[ah]=="SUM"){S+='<div id="sum_'+v.ID+'">'}if(typeof(v[G[ah]])!="undefined"){S+=v[G[ah]]}if(G[ah]=="SUM"){S+="</div>"}h.innerHTML+=S;break}}if(ab||Q){var aj=b.insertCell(-1);aj.setAttribute("class","control");if(ab){aj.innerHTML='<a href="'+basketJSParams.DELETE_URL.replace("#ID#",v.ID)+'">'+basketJSParams.SALE_DELETE+"</a><br />"}if(Q){aj.innerHTML+='<a href="'+basketJSParams.DELAY_URL.replace("#ID#",v.ID)+'">'+basketJSParams.SALE_DELAY+"</a>"}}var s=b.insertCell(-1);s.setAttribute("class","margin")}}if(!!T.BASKET_DATA){for(V in T.BASKET_DATA.GRID.ROWS){if(T.BASKET_DATA.GRID.ROWS.hasOwnProperty(V)){var R=T.BASKET_DATA.GRID.ROWS[V];if(BX("discount_value_"+V)){BX("discount_value_"+V).innerHTML=R.DISCOUNT_PRICE_PERCENT_FORMATED}if(BX("current_price_"+V)){BX("current_price_"+V).innerHTML=R.PRICE_FORMATED}if(BX("old_price_"+V)){BX("old_price_"+V).innerHTML=(R.DISCOUNT_PRICE_PERCENT>0)?R.FULL_PRICE_FORMATED:""}if(BX("sum_"+V)){BX("sum_"+V).innerHTML=R.SUM}if(BX("QUANTITY_"+V)){BX("QUANTITY_INPUT_"+V).value=R.QUANTITY;BX("QUANTITY_INPUT_"+V).defaultValue=R.QUANTITY;BX("QUANTITY_"+V).value=R.QUANTITY}}}}if(!!T.BASKET_DATA){couponListUpdate(T.BASKET_DATA)}if(T.hasOwnProperty("WARNING_MESSAGE")){var M="";for(ah=T.WARNING_MESSAGE.length-1;ah>=0;ah--){M+=T.WARNING_MESSAGE[ah]+"<br/>"}BX("warning_message").innerHTML=M}if(!!T.BASKET_DATA){if(BX("allWeight_FORMATED")){BX("allWeight_FORMATED").innerHTML=T.BASKET_DATA["allWeight_FORMATED"].replace(/\s/g,"&nbsp;")}if(BX("allSum_wVAT_FORMATED")){BX("allSum_wVAT_FORMATED").innerHTML=T.BASKET_DATA["allSum_wVAT_FORMATED"].replace(/\s/g,"&nbsp;")}if(BX("allVATSum_FORMATED")){BX("allVATSum_FORMATED").innerHTML=T.BASKET_DATA["allVATSum_FORMATED"].replace(/\s/g,"&nbsp;")}if(BX("allSum_FORMATED")){BX("allSum_FORMATED").innerHTML=T.BASKET_DATA["allSum_FORMATED"].replace(/\s/g,"&nbsp;")}if(BX("PRICE_WITHOUT_DISCOUNT")){var u=(T.BASKET_DATA["PRICE_WITHOUT_DISCOUNT"]!=T.BASKET_DATA["allSum_FORMATED"]);BX("PRICE_WITHOUT_DISCOUNT").innerHTML=u?T.BASKET_DATA["PRICE_WITHOUT_DISCOUNT"].replace(/\s/g,"&nbsp;"):"";BX.style(BX("PRICE_WITHOUT_DISCOUNT").parentNode,"display",(u?"table-row":"none"))}BX.onCustomEvent("OnBasketChange")}}function couponCreate(a,b){var c="disabled";if(!BX.type.isElementNode(a)){return}if(b.JS_STATUS==="BAD"){c="bad"}else{if(b.JS_STATUS==="APPLYED"){c="good"}}a.appendChild(BX.create("div",{props:{className:"bx_ordercart_coupon"},children:[BX.create("input",{props:{className:c,type:"text",value:b.COUPON,name:"OLD_COUPON[]"},attrs:{disabled:true,readonly:true}}),BX.create("span",{props:{className:c},attrs:{"data-coupon":b.COUPON}}),BX.create("div",{props:{className:"bx_ordercart_coupon_notes"},html:b.JS_CHECK_CODE})]}))}function couponListUpdate(f){var c,a,b,k,h,e,d,g;if(!!f&&typeof f!=="object"){return}c=BX("coupons_block");if(!!c){if(!!f.COUPON_LIST&&BX.type.isArray(f.COUPON_LIST)){b=BX("coupon");if(!!b){b.value=""}k=BX.findChildren(c,{tagName:"input",property:{name:"OLD_COUPON[]"}},true);if(!!k){if(BX.type.isElementNode(k)){k=[k]}for(e=0;e<f.COUPON_LIST.length;e++){h=false;g=-1;for(d=0;d<k.length;d++){if(k[d].value===f.COUPON_LIST[e].COUPON){h=true;g=d;k[d].couponUpdate=true;break}}if(h){a="disabled";if(f.COUPON_LIST[e].JS_STATUS==="BAD"){a="bad"}else{if(f.COUPON_LIST[e].JS_STATUS==="APPLYED"){a="good"}}BX.adjust(k[g],{props:{className:a}});BX.adjust(k[g].nextSibling,{props:{className:a}});BX.adjust(k[g].nextSibling.nextSibling,{html:f.COUPON_LIST[e].JS_CHECK_CODE})}else{couponCreate(c,f.COUPON_LIST[e])}}for(d=0;d<k.length;d++){if(typeof(k[d].couponUpdate)==="undefined"||!k[d].couponUpdate){BX.remove(k[d].parentNode);k[d]=null}else{k[d].couponUpdate=null}}}else{for(e=0;e<f.COUPON_LIST.length;e++){couponCreate(c,f.COUPON_LIST[e])}}}}c=null}function skuPropClickHandler(){var g=this,j,k,h={},b={},e,a,f,c,d;if(!!g&&g.hasAttribute("data-value-id")){BX.showWait();j=g.getAttribute("data-element");k=g.getAttribute("data-property");e=BX("action_var").value;h[k]=BX.util.htmlspecialcharsback(g.getAttribute("data-value-id"));if(BX.hasClass(g,"bx_active")){BX.closeWait();return}a=BX.findChildren(BX(j),{tagName:"ul",className:"sku_prop_list"},true);if(!!a&&a.length>0){for(f=0;a.length>f;f++){if(a[f].id!=="prop_"+k+"_"+j){c=BX.findChildren(BX(a[f].id),{tagName:"li",className:"bx_active"},true);if(!!c&&c.length>0){for(d=0;c.length>d;d++){if(c[d].hasAttribute("data-value-id")){h[c[d].getAttribute("data-property")]=BX.util.htmlspecialcharsback(c[d].getAttribute("data-value-id"))}}}}}}b={basketItemId:j,sessid:BX.bitrix_sessid(),site_id:BX.message("SITE_ID"),props:h,action_var:e,select_props:BX("column_headers").value,offers_props:BX("offers_props").value,quantity_float:BX("quantity_float").value,price_vat_show_value:BX("price_vat_show_value").value,hide_coupon:BX("hide_coupon").value,use_prepayment:BX("use_prepayment").value};b[e]="select_item";BX.ajax({url:"/bitrix/components/bitrix/sale.basket.basket/ajax.php",method:"POST",data:b,dataType:"json",onsuccess:function(i){BX.closeWait();updateBasketTable(j,i)}})}}function getColumnName(a,b){if(BX("col_"+b)){return BX.util.trim(BX("col_"+b).innerHTML)}else{return""}}function leftScroll(e,d,c){c=parseInt(c,10);var b=BX("prop_"+e+"_"+d);if(b){var a=parseInt(b.style.marginLeft,10);if(a<=-20){b.style.marginLeft=a+20+"%"}}}function rightScroll(e,d,c){c=parseInt(c,10);var b=BX("prop_"+e+"_"+d);if(b){var a=parseInt(b.style.marginLeft,10);if(a>(5-c)*20){b.style.marginLeft=a-20+"%"}}}function checkOut(){if(!!BX("coupon")){BX("coupon").disabled=true}BX("basket_form").submit();return true}function updateBasket(){recalcBasketAjax({})}function enterCoupon(){var a=BX("coupon");if(!!a&&!!a.value){recalcBasketAjax({coupon:a.value})}}function updateQuantity(m,e,k,d){var l=BX(m).defaultValue,c=parseFloat(BX(m).value)||0,i=false,b=((BX("auto_calculation")&&BX("auto_calculation").value=="Y")||!BX("auto_calculation"));if(k===0||k==1){i=true}else{var f=c*10000,g=k*10000,j=f%g,a=parseInt(c);if(j===0){i=true}}var h=false;if(parseInt(c)!=parseFloat(c)){h=true}c=(d===false&&h===false)?parseInt(c):parseFloat(c).toFixed(4);c=correctQuantity(c);if(i){BX(m).defaultValue=c;BX("QUANTITY_INPUT_"+e).value=c;BX("QUANTITY_"+e).value=c;if(b){basketPoolQuantity.changeQuantity(e)}}else{c=getCorrectRatioQuantity(c,k,d);c=correctQuantity(c);if(c!=l){BX("QUANTITY_INPUT_"+e).value=c;BX("QUANTITY_"+e).value=c;if(b){basketPoolQuantity.changeQuantity(e)}}else{BX(m).value=l}}}function setQuantity(b,e,a,f){var d=parseFloat(BX("QUANTITY_INPUT_"+b).value),c;c=(a=="up")?d+e:d-e;if(c<0){c=0}if(f){c=parseFloat(c).toFixed(4)}c=correctQuantity(c);if(e>0&&c<e){c=e}if(!f&&c!=c.toFixed(4)){c=parseFloat(c).toFixed(4)}c=getCorrectRatioQuantity(c,e,f);c=correctQuantity(c);BX("QUANTITY_INPUT_"+b).value=c;BX("QUANTITY_INPUT_"+b).defaultValue=c;updateQuantity("QUANTITY_INPUT_"+b,b,e,f)}function getCorrectRatioQuantity(d,h,a){var b=d*10000,c=h*10000,g=(d/h-((d/h).toFixed(0))).toFixed(6),j=d,e=false,f;h=parseFloat(h);if(g==0){return j}if(h!==0&&h!=1){for(f=h,max=parseFloat(d)+parseFloat(h);f<=max;f=parseFloat(parseFloat(f)+parseFloat(h)).toFixed(4)){j=f}}else{if(h===1){j=d|0}}if(parseInt(j,10)!=parseFloat(j)){e=true}j=(a===false&&e===false)?parseInt(j,10):parseFloat(j).toFixed(4);j=correctQuantity(j);return j}function correctQuantity(a){return parseFloat((a*1).toString())}function recalcBasketAjax(g){if(basketPoolQuantity.isProcessing()){return false}BX.showWait();var e={},d=BX("action_var").value,b=BX("basket_items"),f=BX("delayed_items"),a,c;a={sessid:BX.bitrix_sessid(),site_id:BX.message("SITE_ID"),props:e,action_var:d,select_props:BX("column_headers").value,offers_props:BX("offers_props").value,quantity_float:BX("quantity_float").value,price_vat_show_value:BX("price_vat_show_value").value,hide_coupon:BX("hide_coupon").value,use_prepayment:BX("use_prepayment").value};a[d]="recalculate";if(!!g&&typeof g==="object"){for(c in g){if(g.hasOwnProperty(c)){a[c]=g[c]}}}if(!!b&&b.rows.length>0){for(c=1;b.rows.length>c;c++){a["QUANTITY_"+b.rows[c].id]=BX("QUANTITY_"+b.rows[c].id).value}}if(!!f&&f.rows.length>0){for(c=1;f.rows.length>c;c++){a["DELAY_"+f.rows[c].id]="Y"}}basketPoolQuantity.setProcessing(true);basketPoolQuantity.clearPool();BX.ajax({url:"/bitrix/components/bitrix/sale.basket.basket/ajax.php",method:"POST",data:a,dataType:"json",onsuccess:function(h){BX.closeWait();basketPoolQuantity.setProcessing(false);if(g.coupon){if(!!h&&!!h.BASKET_DATA&&!!h.BASKET_DATA.NEED_TO_RELOAD_FOR_GETTING_GIFTS){BX.reload()}}if(basketPoolQuantity.isPoolEmpty()){updateBasketTable(null,h);basketPoolQuantity.updateQuantity()}else{basketPoolQuantity.enableTimer(true)}}})}function showBasketItemsList(a){BX.removeClass(BX("basket_toolbar_button"),"current");BX.removeClass(BX("basket_toolbar_button_delayed"),"current");BX.removeClass(BX("basket_toolbar_button_subscribed"),"current");BX.removeClass(BX("basket_toolbar_button_not_available"),"current");BX("normal_count").style.display="inline-block";BX("delay_count").style.display="inline-block";BX("subscribe_count").style.display="inline-block";BX("not_available_count").style.display="inline-block";if(a==2){if(BX("basket_items_list")){BX("basket_items_list").style.display="none"}if(BX("basket_items_delayed")){BX("basket_items_delayed").style.display="block";BX.addClass(BX("basket_toolbar_button_delayed"),"current");BX("delay_count").style.display="none"}if(BX("basket_items_subscribed")){BX("basket_items_subscribed").style.display="none"}if(BX("basket_items_not_available")){BX("basket_items_not_available").style.display="none"}}else{if(a==3){if(BX("basket_items_list")){BX("basket_items_list").style.display="none"}if(BX("basket_items_delayed")){BX("basket_items_delayed").style.display="none"}if(BX("basket_items_subscribed")){BX("basket_items_subscribed").style.display="block";BX.addClass(BX("basket_toolbar_button_subscribed"),"current");BX("subscribe_count").style.display="none"}if(BX("basket_items_not_available")){BX("basket_items_not_available").style.display="none"}}else{if(a==4){if(BX("basket_items_list")){BX("basket_items_list").style.display="none"}if(BX("basket_items_delayed")){BX("basket_items_delayed").style.display="none"}if(BX("basket_items_subscribed")){BX("basket_items_subscribed").style.display="none"}if(BX("basket_items_not_available")){BX("basket_items_not_available").style.display="block";BX.addClass(BX("basket_toolbar_button_not_available"),"current");BX("not_available_count").style.display="none"}}else{if(BX("basket_items_list")){BX("basket_items_list").style.display="block";BX.addClass(BX("basket_toolbar_button"),"current");BX("normal_count").style.display="none"}if(BX("basket_items_delayed")){BX("basket_items_delayed").style.display="none"}if(BX("basket_items_subscribed")){BX("basket_items_subscribed").style.display="none"}if(BX("basket_items_not_available")){BX("basket_items_not_available").style.display="none"}}}}}function deleteCoupon(){var b=this,a;if(BX.type.isElementNode(b)&&b.hasAttribute("data-coupon")){a=b.getAttribute("data-coupon");if(BX.type.isNotEmptyString(a)){recalcBasketAjax({delete_coupon:a})}}}function deleteProductRow(c){var b=BX.findParent(c,{tagName:"TR"}),a,d;if(b){a=BX("QUANTITY_"+b.id);if(a){d=getCurrentItemAnalyticsInfo(b,a.value)}}setAnalyticsDataLayer([],[d]);document.location.href=c.href;return false}function checkAnalytics(d,b){if(!d||!b||BX.util.array_values(d).length===0){return}var h,g,f={},a=[],e=[],c;if(!!b&&b.rows.length){for(c=1;b.rows.length>c;c++){h=b.rows[c].id;g=BX("QUANTITY_"+h).value-d[h];if(g!=0){f=getCurrentItemAnalyticsInfo(b.rows[c],g);if(g>0){a.push(f)}else{e.push(f)}}}}if(a.length||e.length){setAnalyticsDataLayer(a,e)}}function getCurrentItemAnalyticsInfo(f,e){if(!f){return}var c,b,a=[];var d={name:f.getAttribute("data-item-name")||"",id:f.id,price:f.getAttribute("data-item-price")||0,brand:(f.getAttribute("data-item-brand")||"").split(",  ").join("/"),variant:"",quantity:Math.abs(e)};c=f.querySelectorAll(".bx_active[data-sku-name]");for(b=0;b<c.length;b++){a.push(c[b].getAttribute("data-sku-name"))}d.variant=a.join("/");return d}function setAnalyticsDataLayer(a,b){window[basketJSParams.DATA_LAYER_NAME]=window[basketJSParams.DATA_LAYER_NAME]||[];if(a&&a.length){window[basketJSParams.DATA_LAYER_NAME].push({event:"addToCart",ecommerce:{currencyCode:getCurrencyCode(),add:{products:a}}})}if(b&&b.length){window[basketJSParams.DATA_LAYER_NAME].push({event:"removeFromCart",ecommerce:{currencyCode:getCurrencyCode(),remove:{products:b}}})}}function getCurrencyCode(){var b=BX("basket_items"),c,a="";if(b){c=b.querySelector("[data-item-currency");c&&(a=c.getAttribute("data-item-currency"))}return a}BX.ready(function(){basketPoolQuantity=new BasketPoolQuantity();var a=BX("coupons_block"),b=BX("basket_items");if(BX.type.isElementNode(a)){BX.bindDelegate(a,"click",{attribute:"data-coupon"},deleteCoupon)}if(BX.type.isElementNode(b)){BX.bindDelegate(b,"click",{tagName:"li",attr:{"data-sku-selector":"Y"}},skuPropClickHandler)}if(BX.type.isNotEmptyString(basketJSParams.EVENT_ONCHANGE_ON_START)&&basketJSParams.EVENT_ONCHANGE_ON_START=="Y"){BX.onCustomEvent("OnBasketChange")}});